<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Gems‚ùÑÔ∏è | Inventaire Global</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #000000;
      --text: #f5f5f7;
      --text-secondary: #a0a0a5;
      --accent: #0a84ff;
      --glass: rgba(30, 30, 32, 0.88);
      --border: rgba(255, 255, 255, 0.12);
      --shadow: 0 10px 30px rgba(0,0,0,0.5);
      --danger: #ff453a;
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', system-ui, sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
      background-image: url('m7.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      touch-action: manipulation;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.68);
      z-index: -2;
    }

    /* ‚îÄ‚îÄ Navbar fixe + mini-barre Cercle Priv√© ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
      background: var(--glass);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      padding: 0.85rem 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transform: translateY(-100%);
      transition: transform 0.7s 0.4s ease;
    }

    nav.visible {
      transform: translateY(0);
    }

    .logo {
      font-size: clamp(1.35rem, 5.8vw, 1.65rem);
      font-weight: 900;
      letter-spacing: -0.3px;
    }

    .menu-toggle {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.95rem;
      cursor: pointer;
      padding: 0.4rem;
      display: block !important; /* toujours visible, comme demand√© */
    }

    /* Mini-barre Cercle Priv√© */
    .announce-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 999;
      margin-top: 2.8rem;
      background: var(--glass);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      padding: 0.35rem 5%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.9rem;
      font-size: 0.86rem;
      flex-wrap: wrap;
    }

    .announce-badge {
      background: #000;
      color: #fff;
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    .announce-text strong { color: var(--accent); }

    .join-link {
      background: rgba(10,132,255,0.82);
      color: white;
      padding: 0.3rem 1rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      text-decoration: none;
    }

    .join-link:active { background: var(--accent); transform: scale(0.97); }

    /* Menu burger mobile (plein √©cran) */
    .nav-menu-mobile {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.96);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 2.2rem;
      transform: translateY(-100%);
      transition: transform 0.45s ease;
      z-index: 998;
    }

    .nav-menu-mobile.open { transform: translateY(0); }

    .nav-menu-mobile a {
      font-size: 1.35rem;
      padding: 1rem 2.5rem;
      color: var(--text);
      text-decoration: none;
      font-weight: 500;
    }

    .close-menu {
      position: absolute;
      top: 1.2rem; right: 1.2rem;
      background: none;
      border: none;
      color: white;
      font-size: 2.5rem;
      cursor: pointer;
    }

    /* Contenu principal */
    main {
      padding: 8.5rem 5% 3rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      font-size: clamp(2.4rem, 10vw, 4.2rem);
      font-weight: 900;
      margin-bottom: 2rem;
      background: linear-gradient(90deg, var(--text) 40%, var(--accent) 70%, var(--text) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem;
    }

    .card {
      background: var(--glass);
      backdrop-filter: blur(14px);
      border: 1px solid var(--border);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.5s ease;
      opacity: 0;
      transform: translateY(40px) scale(0.97);
    }

    .card.visible {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .card:nth-child(odd)  { transition-delay: 0.1s; }
    .card:nth-child(even) { transition-delay: 0.18s; }

    .card:hover, .card:active {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
    }

    .card-img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      background: #111;
    }

    .card-body {
      padding: 1.6rem;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .badge {
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-prod { background: rgba(10,132,255,0.15); color: var(--accent); border: 1px solid rgba(10,132,255,0.3); }
    .badge-ann { background: rgba(255,149,0,0.15); color: #ff9500; border: 1px solid rgba(255,149,0,0.3); }

    .card-title {
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 0.6rem;
    }

    .card-price {
      font-size: 1.25rem;
      font-weight: 800;
      margin-bottom: 1rem;
    }

    .card-desc {
      color: var(--text-secondary);
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: 1.4rem;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .btn-delete {
      background: rgba(255,69,58,0.9);
      color: white;
      border: none;
      width: 100%;
      padding: 1rem;
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      min-height: 52px;
    }

    .btn-delete:active {
      background: #ff3333;
      transform: scale(0.97);
    }

    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      color: var(--text-secondary);
      padding: 5rem 2rem;
      border: 2px dashed var(--border);
      border-radius: 20px;
      font-size: 1.2rem;
    }

    /* Responsive */
    @media (max-width: 767px) {
      .announce-bar { margin-top: 2.7rem; padding: 0.32rem 4%; font-size: 0.82rem; gap: 0.7rem; }
      main { padding: 7.5rem 4% 2.5rem; }
      .grid { grid-template-columns: 1fr; }
    }

    @media (min-width: 768px) {
      nav { padding: 1rem 7%; }
      .announce-bar { margin-top: 3.5rem; }
      main { padding: 9rem 6% 4rem; }
    }
  </style>
</head>
<body>

  <nav id="navbar">
    <div class="logo">Gems‚ùÑÔ∏è</div>
    <button class="menu-toggle" id="menuToggle">‚ò∞</button>
  </nav>

  <div class="announce-bar">
    <span class="announce-badge">PRIV√â</span>
    <span class="announce-text"><strong>Le Cercle Priv√©</strong> ‚Äì Drops en priorit√©</span>
    <a href="https://chat.whatsapp.com/D6BcVIbllGL7Fj6YVqPccP?mode=gi_t" target="_blank" rel="noopener" class="join-link">
      Rejoindre ‚Üí
    </a>
  </div>

  <div class="nav-menu-mobile" id="mobileMenu">
    <button class="close-menu" id="closeMenu">‚úï</button>
    <a href="dashboard.html">üì¶ Nouveau Produit</a>
    <a href="admin-annonces.html">Nouvelle Annonce</a>
    <a href="admin-inventaire.html" class="active">Mes Publications</a>
    <a href="admin-historique.html">Historique</a>
    <a href="admin-details-manager.html">√âditeur D√©tails</a>
  </div>

  <main>
    <h1>Gestion de l'Inventaire</h1>

    <div style="text-align:right; margin-bottom:1.5rem;">
      <button onclick="chargerInventaire()" style="background:rgba(10,132,255,0.2); color:var(--accent); border:1px solid var(--accent); padding:0.8rem 1.6rem; border-radius:999px; cursor:pointer; font-weight:600;">
        üîÑ Actualiser
      </button>
    </div>

    <div id="grid-container" class="grid">
      <div class="empty-state">Chargement des publications...</div>
    </div>
  </main>

  <script>
    const nexa = supabase.createClient("https://antifrphxjyaylklsijh.supabase.co", "sb_publishable_bhzXA7_xxTiWIkU07LZCDw_YsDIYEBl");

    // Apparition navbar au chargement
    window.addEventListener('load', () => {
      document.getElementById('navbar').style.transform = 'translateY(0)';
    });

    // Menu burger (toujours visible)
    const toggle = document.getElementById('menuToggle');
    const menu = document.getElementById('mobileMenu');
    const closeBtn = document.getElementById('closeMenu');

    toggle?.addEventListener('click', () => menu.classList.add('open'));
    closeBtn?.addEventListener('click', () => menu.classList.remove('open'));
    menu?.addEventListener('click', e => { if (e.target === menu) menu.classList.remove('open'); });

    // Chargement inventaire
    async function chargerInventaire() {
      const container = document.getElementById('grid-container');
      container.innerHTML = '<div class="empty-state">Chargement des publications...</div>';

      try {
        const { data, error } = await nexa
          .from('produits')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) throw error;

        if (!data || data.length === 0) {
          container.innerHTML = `<div class="empty-state">Aucune publication trouv√©e.<br>Ajoutez un produit ou une annonce.</div>`;
          return;
        }

        container.innerHTML = '';

        data.forEach(item => {
          const type = item.type || 'produit';
          const isAnnonce = type === 'annonce';

          const badgeClass = isAnnonce ? 'badge-ann' : 'badge-prod';
          const badgeText = isAnnonce ? 'PUBLICIT√â' : 'PRODUIT';

          const priceHtml = isAnnonce 
            ? '<span style="font-size:0.9rem; color:var(--text-secondary);">Diffusion active</span>' 
            : `<span class="card-price">${item.prix || 'Prix sur demande'}</span>`;

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <img src="${item.image_url || 'https://via.placeholder.com/400x220?text=Pas+d\'image'}" class="card-img" loading="lazy">
            <div class="card-body">
              <div class="card-header">
                <span class="badge ${badgeClass}">${badgeText}</span>
                <span style="font-size:0.85rem; color:var(--text-secondary);">
                  ${new Date(item.created_at).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', year: 'numeric' })}
                </span>
              </div>
              <h3 class="card-title">${item.titre || 'Sans titre'}</h3>
              ${priceHtml}
              <p class="card-desc">${item.description || 'Aucune description'}</p>
              <button class="btn-delete" onclick="supprimer('${item.id}')">Supprimer</button>
            </div>
          `;
          container.appendChild(card);
        });

        // Apparition progressive des cartes
        const observer = new IntersectionObserver(entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('visible');
          });
        }, { threshold: 0.1 });

        document.querySelectorAll('.card').forEach(card => observer.observe(card));

      } catch (err) {
        console.error(err);
        container.innerHTML = `<div class="empty-state" style="color:#ff4d4d">Erreur : ${err.message}</div>`;
      }
    }

    async function supprimer(id) {
      if (!confirm("‚ö†Ô∏è Cette action est irr√©versible.\nConfirmer la suppression ?")) return;

      try {
        const { error } = await nexa.from('produits').delete().eq('id', id);
        if (error) throw error;
        chargerInventaire();
      } catch (err) {
        alert("Erreur suppression : " + err.message);
      }
    }

    // Chargement initial
    chargerInventaire();
  </script>
</body>
</html>